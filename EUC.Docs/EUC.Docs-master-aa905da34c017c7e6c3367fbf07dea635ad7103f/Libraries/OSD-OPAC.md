
# Build
TODO

# Desired State Configuration
## Updating
Changes made to the DSC configuration can be reflected on the client by running `Build-OPACConfig.ps1` under `C:\DSC\DSCSource`. This script will generate the MOF file, copy to the appropriate folder and generate a new checksum. You may need to update the `PSModules` environment variable first by running the command `$env:PSModulePath += ';C:\DSC\DSCSource;C:\Program Files\WindowsPowerShell\Modules'`.

A client can be updated by opening an elevated PowerShell prompt and running `update-dscconfiguration -verbose -wait` or you can wait 30 minutes for the client to perform the update itself.

# Group Policies
All OPAC PC's should be placed under the `OU=OPAC,OU=Computers,OU=Library,DC=libmgmt,DC=local` OU. There is a computer policy linked to the parent OU called `EUC-C-Global`, and two policies on the OPAC OU:

* `EUC-C-OPACSettings` - computer settings for OPAC PC's
* `EUC-C-WsusGroupForOPAC` - sets the WSUS group PC's should report in 

Any OPAC user should be placed under the `OU=OPAC,OU=Users,OU=Library,DC=libmgmt,DC=local` OU. Group policy lookback is not implemented so administrative users can log on to the OPAC PC's to make any necessary changes. One policy is linked to this OU:

* `EUC-U-OPAC` - user settings for OPAC PC's

Where applicable a description within the policy has been made to any customized group policy setting.

# Proxy Configuration
See [COE Infrastructure]({{< ref "libraries/infrastructure.md" >}}). This proxy server is enforced through group policy.

# Shortcuts
An MSI package called `BCC.EUC.OPACShortcuts.msi` includes several shortcuts to help users end their session, as well as open the catalogue. It also includes several icons used by both the shortcuts and the Start Screen. The MSI package was created with WIX, and it can be generated by running `build.cmd` under `C:\DSC\OPACShortcuts`. In the subfolder `files` are the icon files and AutoHotkey scripts that are converted in to `exe` files.

~~~~ xml
<!-- main.wxs -->
<?xml version="1.0"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product Id="{4153817d-4961-4335-b3cd-d0576d4d6018}" Name="OPAC Shortcuts" Language="1033" Version="1.2.0.0" Manufacturer="Brisbane City Council" UpgradeCode="{226b559b-396b-491c-9b11-3ec79555d9bf}">
    <Package Description="OPAC Shortcuts" Manufacturer="Brisbane City Council" InstallerVersion="200" Compressed="yes" Platform="x64" />
    <MajorUpgrade DowngradeErrorMessage="A later version of [ProductName] is already installed. Setup will now exit." />
    <Media Id="1" Cabinet="product.cab" EmbedCab="yes" />
    <Property Id="ALLUSERS" Value="1" />
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramMenuFolder" Name="ProgramMenuFolder">
        <!--<Directory Id="dir0234d8a725da477b898d4214fa3ed162" Name="Programs" />-->
      </Directory>
      <Directory Id="ProgramFiles64Folder" Name="ProgramFiles64Folder">
        <Directory Id="dirde4829d7bf41435aa957c0bbf2077f31" Name="BCC">
          <Directory Id="dir790a6871550541f7b5f54ebfaf2fc14d" Name="Config">
              <Component Id="cmp0e82fbc3d51647289b35e0fa260f4288" Guid="*" Win64="yes">
                <File Id="search_catalogue_exe" Name="Search Catalogue.exe" DiskId="1" Source="files\Search Catalogue.exe">
                  <Shortcut Id="sht6a75f74561714d5aa2ea67cb2e0e675b"
                            Directory="ProgramMenuFolder"
                            Name="Search Catalogue"
                            WorkingDirectory="INSTALLFOLDER"
                            Advertise='yes'
                            Icon="searchcatalogue.exe"
                            IconIndex="0">
                    <Icon Id="searchcatalogue.exe" SourceFile="files\Search Catalogue.exe" />
                    <ShortcutProperty Key="System.AppUserModel.ID" Value="BCC.OPAC.SearchCatalog.1" />
                  </Shortcut>
                </File>
              </Component>
              <Component Id="cmp681754a18e754926ad6a63905981c460" Guid="*" Win64="yes">
                <File Id="end_session_exe" Name="End Session.exe" DiskId="1" Source="files\End Session.exe">
                  <Shortcut Id="sht68c3fbfd31db45ddb235a2fd4b253144"
                            Directory="ProgramMenuFolder"
                            Name="End Session"
                            WorkingDirectory="INSTALLFOLDER"
                            Advertise='yes'
                            Icon="endsession.exe"
                            IconIndex="0">
                    <Icon Id="endsession.exe" SourceFile="files\End Session.exe" />
                    <ShortcutProperty Key="System.AppUserModel.ID" Value="BCC.OPAC.SearchCatalog.2" />
                  </Shortcut>
                </File>
              </Component>
          </Directory>
        </Directory>
      </Directory>
    </Directory>
    <DirectoryRef Id="TARGETDIR">
    </DirectoryRef>
    <Feature Id="MainFeature" Title="OPAC Shortcuts" Level="1">
      <ComponentRef Id="cmp0e82fbc3d51647289b35e0fa260f4288" />
      <ComponentRef Id="cmp681754a18e754926ad6a63905981c460" />
    </Feature>
  </Product>
</Wix>
~~~~

~~~~
;Search Catalogue.ahk
#NoEnv
#Warn
#NoTrayIcon
SendMode Input
SetWorkingDir %A_ScriptDir%

Run, c:\Program Files (x86)\Google\Chrome\Application\chrome.exe
~~~~

~~~~
;End Session.ahk
#NoEnv
#Warn
#NoTrayIcon
SendMode Input
SetWorkingDir %A_ScriptDir%
WinClose, ahk_exe chrome.exe
Send, {LWin}
~~~~

# Start Screen
The OPAC Start Screen is enforced by group policy to a set XML file. The XML file is created by the local DSC policy.

~~~~ xml
<?xml version="1.0"?>
<launcher version="2">
    <view name="Start">
        <group name="Catalogue">
            <tile AppID="BCC.OPAC.SearchCatalog.1" FencePost="0" size="square150x150"/>
        </group>
        <group name="Ease of Access Tools">
            <tile FencePost="0" size="square150x150" AppID="{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}\magnify.exe"/>
            <tile FencePost="0" size="square150x150" AppID="{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}\narrator.exe"/>
            <tile FencePost="0" size="square150x150" AppID="{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}\osk.exe"/>
        </group>
    </view>
</launcher>
~~~~

# Applications
The following applications are installed by the local DSC policy. The source files can be found on `m570prd1` under `c:\data\apps`:

* Adobe Reader XI
* Google Chrome
* Microsoft Office Excel Viewer
* Microsoft Office Word Viewer 2003
* Microsoft PowerPoint Viewer
* Compatibility Pack for the 2007 Office System

